# Output Data Directory

This directory contains all processed datasets, analysis results, and summary statistics generated by the EMF Canada analysis pipeline.

## Directory Structure

```
outdata/
├── README.md                               # This file
├── session_info.csv                        # R session information
├── session_info.rds                        # Detailed session data
├── download_summary.rds                     # External data download log
├── spatial_processing_summary.rds          # Spatial processing results
├── fungal_processing_summary.rds           # Fungal data processing results
├── metrics_summary.rds                     # All calculated metrics
├── maps_summary.rds                        # Map generation results
├── final_analysis_workspace.RData          # Complete R workspace
├── file_inventory.csv                      # Complete file listing
│
├── Processed Spatial Data/
├── canada_simple.gpkg                      # Simplified Canada boundary
├── north_america_simple.gpkg               # North America boundary
├── tree_ranges_canada.gpkg                 # Tree species ranges in Canada
├── ecoregions_processed.gpkg               # Processed Canadian ecoregions
├── ecozone_names.csv                       # Ecozone name lookup table
├── canada_ne_albers.gpkg                   # Canada in Albers projection
├── lakes_canada_albers.gpkg                # Canadian lakes (Albers)
├── raster_template_1deg.tif                # Analysis grid template
│
├── EMF Analysis Results/
├── emf_host_tree_ranges.gpkg               # EMF host species ranges
├── emf_samples_canada.gpkg                 # All EMF sample points in Canada
├── emf_samples_aggregated_1000m.gpkg       # Samples clustered by 1km
├── ecoregions_with_emf_habitat.gpkg        # Ecoregions containing EMF habitat
├── sampled_habitat_ecoregions.gpkg         # Ecoregions with EMF samples
│
├── Richness and Coverage Rasters/
├── species_richness_1deg.tif               # Tree species richness (1° grid)
├── emf_richness_1deg.tif                   # EMF species richness (1° grid)
├── emf_proportion_1deg.tif                 # EMF data coverage proportion
│
└── Summary Statistics and Tables/
    ├── basic_emf_stats.rds                 # Core EMF statistics
    ├── basic_emf_stats.csv                 # Core EMF statistics (CSV)
    ├── emf_summary_statistics.csv          # Comprehensive summary table
    ├── knowledge_gaps_summary.csv          # Knowledge shortfalls analysis
    ├── proportion_statistics.csv           # Spatial coverage metrics
    └── spatial_processing_checkpoint.rds   # Processing checkpoint (temporary)
```

## File Descriptions

### Session and Process Information

#### `session_info.csv` / `session_info.rds`
**Description**: R session information and package versions
**Generated by**: `01_setup.R`
**Use**: Reproducibility documentation, troubleshooting
**Format**: CSV table and R binary

#### `download_summary.rds`
**Description**: Log of external data downloads with timestamps
**Generated by**: `02_download_data.R`
**Contents**:
- File paths to downloaded datasets
- Download timestamps
- Success/failure status

#### `*_processing_summary.rds`
**Description**: Results summaries from each processing step
**Generated by**: Individual processing scripts
**Contents**: File paths, statistics, processing metadata

#### `final_analysis_workspace.RData`
**Description**: Complete R workspace from full analysis run
**Generated by**: `run_complete_analysis.R`
**Use**: Resume analysis, access all objects

---

### Processed Spatial Data

#### `canada_simple.gpkg`
**Description**: Simplified Canada boundary for analysis
**Generated by**: `03_process_spatial.R`
**Source**: GADM Canada boundaries
**Projection**: WGS84 (EPSG:4326)
**Use**: Clipping and masking operations

#### `north_america_simple.gpkg`
**Description**: Simplified North America boundary
**Generated by**: `03_process_spatial.R`
**Contents**: Canada, continental USA, Mexico
**Projection**: WGS84 (EPSG:4326)
**Use**: Regional context mapping

#### `tree_ranges_canada.gpkg`
**Description**: Tree species range maps clipped to Canada
**Generated by**: `03_process_spatial.R`
**Source**: USTreeAtlas + species_ranges.csv
**Attributes**:
- `species_name`: Species code
- `species`: Full species name
- `genus`: Genus name
- `common`: Common name
**Projection**: WGS84 (EPSG:4326)

#### `ecoregions_processed.gpkg`
**Description**: Canadian ecoregions with standardized attributes
**Generated by**: `03_process_spatial.R`
**Source**: Agriculture Canada ecoregions
**Attributes**: Ecoregion and ecozone classifications
**Projection**: WGS84 (EPSG:4326)

#### `ecozone_names.csv`
**Description**: Lookup table for ecozone names
**Generated by**: `03_process_spatial.R`
**Columns**: Ecozone codes and English names

#### `canada_ne_albers.gpkg` / `lakes_canada_albers.gpkg`
**Description**: Base mapping data in Canada Albers projection
**Generated by**: `03_process_spatial.R`
**Source**: Natural Earth data
**Projection**: Canada Albers Equal Area
**Use**: High-quality cartographic mapping

#### `raster_template_1deg.tif`
**Description**: Analysis grid template for raster calculations
**Generated by**: `05_calculate_metrics.R`
**Resolution**: 1 degree
**Projection**: WGS84 (EPSG:4326)
**Extent**: Canada bounding box

---

### EMF Analysis Results

#### `emf_host_tree_ranges.gpkg`
**Description**: Tree species identified as EMF hosts
**Generated by**: `04_process_fungal.R`
**Source**: Tree ranges + FungalRoot database
**Attributes**:
- `species_name`: Species identifier
- `species`: Full species name
- `genus`: Genus name
- `MycorrhizalType_SP`: Species-level mycorrhizal type
- `MycorrhizalType_GN`: Genus-level mycorrhizal type
**Filter**: Only species with "EM" designation
**Count**: ~[number] EMF host species in Canada

#### `emf_samples_canada.gpkg`
**Description**: All EMF sample points within Canada
**Generated by**: `04_process_fungal.R`
**Source**: Stephanie's data + van Galen data (if available)
**Attributes**:
- `dataset`: Data source ("Stephanie", "vanGalen", "Both")
- Original sample attributes (varies by dataset)
**Projection**: WGS84 (EPSG:4326)

#### `emf_samples_aggregated_1000m.gpkg`
**Description**: Sample points clustered within 1km distance
**Generated by**: `04_process_fungal.R`
**Purpose**: Reduce spatial autocorrelation in analysis
**Attributes**:
- `dataset`: Aggregated dataset classification
**Algorithm**: Distance-based clustering

#### `ecoregions_with_emf_habitat.gpkg`
**Description**: Ecoregions containing potential EMF habitat
**Generated by**: `05_calculate_metrics.R`
**Method**: Intersection of ecoregions with EMF host ranges
**Use**: Habitat availability assessment

#### `sampled_habitat_ecoregions.gpkg`
**Description**: Habitat ecoregions with EMF sample data
**Generated by**: `05_calculate_metrics.R`
**Method**: Intersection of samples with habitat ecoregions
**Use**: Sampling coverage assessment

---

### Richness and Coverage Rasters

#### `species_richness_1deg.tif`
**Description**: Tree species richness per 1-degree grid cell
**Generated by**: `05_calculate_metrics.R`
**Method**: Count of overlapping species ranges per cell
**Units**: Number of species
**Range**: 0 to maximum richness value
**Use**: Biodiversity hotspot identification

#### `emf_richness_1deg.tif`
**Description**: EMF host species richness per grid cell
**Generated by**: `05_calculate_metrics.R`
**Method**: Count of EMF host species with sequence data
**Units**: Number of EMF species with data
**Range**: 0 to maximum EMF richness
**Use**: EMF research intensity mapping

#### `emf_proportion_1deg.tif`
**Description**: Proportion of species with EMF data per cell
**Generated by**: `05_calculate_metrics.R`
**Method**: EMF richness / total species richness
**Units**: Proportion (0-1)
**Interpretation**: 1.0 = complete EMF data coverage
**Use**: Knowledge gap identification

---

### Summary Statistics and Tables

#### `basic_emf_stats.rds` / `basic_emf_stats.csv`
**Description**: Core EMF analysis statistics
**Generated by**: `04_process_fungal.R`
**Key Metrics**:
- `total_sequence_records`: Number of EMF sequence records
- `total_sampling_locations`: Unique sampling sites
- `unique_emf_taxa`: Number of distinct EMF taxa
- `emf_host_species_count`: Canadian EMF host tree species
- `native_hosts_with_sequences`: Host species with data
- `percent_hosts_with_data`: Percentage of hosts with data
- `unique_host_genera`: Number of host genera with data
- `percent_genera_with_data`: Percentage of genera with data

#### `emf_summary_statistics.csv`
**Description**: Comprehensive analysis summary table
**Generated by**: `utils.R -> create_summary_tables()`
**Contents**: All key metrics in tabular format
**Use**: Report generation, manuscript tables

#### `knowledge_gaps_summary.csv`
**Description**: Knowledge shortfalls analysis summary
**Generated by**: `utils.R -> create_summary_tables()`
**Framework**: Eltonian, Hutchinsonian, Wallacean shortfalls
**Contents**:
- Shortfall type
- Description
- Key findings for each shortfall

#### `proportion_statistics.csv`
**Description**: Spatial coverage metrics
**Generated by**: `05_calculate_metrics.R`
**Metrics**:
- `cells_with_data`: Grid cells with analysis data
- `cells_zero_proportion`: Cells with no EMF data
- `cells_nonzero_proportion`: Cells with some EMF data
- `mean_proportion`: Average EMF coverage
- `max_proportion`: Maximum EMF coverage
- `min_proportion`: Minimum EMF coverage

#### `file_inventory.csv`
**Description**: Complete listing of all output files
**Generated by**: `utils.R -> create_file_inventory()`
**Contents**: File names, paths, sizes, modification dates
**Use**: Data management, archiving

---

## Data Quality and Validation

### Spatial Data Quality
- **Coordinate System**: All spatial data standardized to WGS84
- **Geometry Validity**: Processed with `terra::makeValid()`
- **Topology**: Checked for self-intersections and gaps
- **Extent**: Clipped to Canadian boundaries

### Statistical Validation
- **Missing Values**: Documented and handled appropriately
- **Range Checks**: Values validated against expected ranges
- **Consistency**: Cross-file relationships verified
- **Temporal Consistency**: Processing timestamps recorded

### File Integrity
```r
# Check file completeness
source("scripts/utils.R")
validate_analysis_files()

# Generate file inventory
create_file_inventory()
```

## Usage Guidelines

### Loading Processed Data

#### Spatial Data
```r
library(terra)

# Load EMF host ranges
emf_hosts <- vect("outdata/emf_host_tree_ranges.gpkg")

# Load sample points
samples <- vect("outdata/emf_samples_aggregated_1000m.gpkg")

# Load rasters
richness <- rast("outdata/species_richness_1deg.tif")
```

#### Statistical Data
```r
# Load basic statistics
basic_stats <- readRDS("outdata/basic_emf_stats.rds")

# Load comprehensive metrics
metrics_summary <- readRDS("outdata/metrics_summary.rds")

# Load CSV tables
summary_table <- read.csv("outdata/emf_summary_statistics.csv")
```

### Data Export and Sharing

#### For GIS Software
- **QGIS**: Load .gpkg files directly
- **ArcGIS**: Import .gpkg or convert to .shp
- **Google Earth**: Convert to KML format

```r
# Convert to KML for Google Earth
library(sf)
emf_hosts_sf <- st_read("outdata/emf_host_tree_ranges.gpkg")
st_write(emf_hosts_sf, "emf_hosts.kml")
```

#### For Statistical Analysis
```r
# Export sample coordinates
samples <- vect("outdata/emf_samples_canada.gpkg")
coords <- crds(samples)
write.csv(coords, "sample_coordinates.csv")

# Export raster values
richness_df <- as.data.frame(richness, xy = TRUE)
write.csv(richness_df, "species_richness_data.csv")
```

### Integration with Other Analyses

#### Climate Data Integration
```r
# Use raster template for climate data alignment
template <- rast("outdata/raster_template_1deg.tif")

# Resample climate data to match
climate_aligned <- resample(climate_raster, template)
```

#### Temporal Analysis
```r
# Use sample points for time-series analysis
samples <- vect("outdata/emf_samples_aggregated_1000m.gpkg")
sample_coords <- crds(samples)

# Extract time-series data at sample locations
```

## File Management

### Storage Requirements
- **Total size**: ~1-5 GB (depending on resolution)
- **Critical files**: Summary statistics, EMF host ranges
- **Large files**: Raster datasets (>100 MB each)
- **Temporary files**: Processing checkpoints (can be deleted)

### Backup Strategy
1. **Essential outputs**: Summary tables, processed spatial data
2. **Reproducible outputs**: Rasters (can be regenerated)
3. **Checkpoints**: Delete after successful completion

### Version Control
```r
# Add processing timestamp to files
file_info <- file.info("outdata/emf_summary_statistics.csv")
file_info$mtime  # Last modification time

# Save analysis metadata
analysis_metadata <- list(
  processing_date = Sys.time(),
  r_version = R.version.string,
  script_versions = "See session_info.rds"
)
saveRDS(analysis_metadata, "outdata/analysis_metadata.rds")
```

## Troubleshooting

### Common Issues

**Missing files**: Check if previous processing steps completed
```r
validate_analysis_files()
```

**Corrupted spatial data**: Re-run spatial processing
```r
source("scripts/03_process_spatial.R")
```

**Inconsistent statistics**: Re-run from fungal processing
```r
source("scripts/04_process_fungal.R")
source("scripts/05_calculate_metrics.R")
```

### Data Recovery
```r
# Load most recent workspace
load("outdata/final_analysis_workspace.RData")

# Check processing summaries
spatial_summary <- readRDS("outdata/spatial_processing_summary.rds")
fungal_summary <- readRDS("outdata/fungal_processing_summary.rds")
```

### Performance Optimization
- **Large rasters**: Use `terra::tmpFiles()` to manage temp files
- **Memory**: Monitor usage with `pryr::mem_used()`
- **Disk space**: Clean temporary files regularly

## Data Documentation

### Metadata Standards
All spatial data includes:
- Coordinate reference system
- Processing date
- Source information
- Attribute descriptions

### Reproducibility
- Complete processing chain documented
- R session information saved
- External data versions recorded
- Processing parameters documented

### Citation Requirements
When using processed data, cite:
1. Original data sources (see rawdata/README.md)
2. Processing methods (this analysis)
3. Software versions (session_info.csv)

## Updates and Maintenance

### Regenerating Outputs
```r
# Full regeneration
source("run_complete_analysis.R")

# Partial regeneration from specific step
source("scripts/05_calculate_metrics.R")  # Metrics only
source("scripts/06_create_maps.R")        # Maps only
```

### Adding New Analysis
1. Create new processing script
2. Update output documentation
3. Add validation checks
4. Update this README

### Data Archiving
Recommend archiving:
- Summary statistics (permanent)
- Key spatial outputs (permanent)  
- Full workspace (periodic snapshots)
- Raw inputs (permanent)