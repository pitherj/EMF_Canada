# Figures Directory

This directory contains all maps, visualizations, and figures generated by the EMF Canada analysis pipeline.

## Directory Structure

```
figures/
├── README.md                               # This file
├── canada_sampling_locations_map.png      # EMF sampling coverage map
├── canada_emf_richness_map.png            # EMF species richness map
├── canada_emf_proportion_map.png          # EMF data coverage map
├── canada_emf_bivariate_map.png           # Combined richness/coverage analysis
└── [additional custom figures]            # User-generated visualizations
```

## Figure Descriptions

### `canada_sampling_locations_map.png`
**Purpose**: Display EMF sampling locations across Canadian ecoregions

**Generated by**: `06_create_maps.R -> create_sampling_map()`

**Content**:
- **Base layer**: Canadian ecoregions with distinct colors
- **Water features**: Major lakes in blue
- **Sample points**: Color-coded by data source
  - **White**: Stephanie's dataset only
  - **Yellow**: van Galen dataset only  
  - **Black**: Both datasets (overlapping locations)
- **Boundary**: Canada outline in black

**Key Features**:
- Points aggregated within 1km to reduce visual clutter
- Subtitle shows sample counts by dataset
- Legend distinguishes data sources and ecoregions

**Dimensions**: 12" × 10" at 300 DPI
**Format**: PNG
**Use**: Publication, presentations, gap analysis

---

### `canada_emf_richness_map.png`  
**Purpose**: Visualize EMF species richness across Canada

**Generated by**: `06_create_maps.R -> create_emf_richness_map()`

**Content**:
- **Base layer**: Canada boundary in light grey
- **Data layer**: 1-degree grid cells colored by EMF richness
- **Color scale**: White to red gradient
  - White: No EMF data
  - Light blue to blue: Low richness (1-2 species)
  - Dark blue to purple: Medium richness (3-4 species)  
  - Red: High richness (5+ species)

**Data Source**: EMF host species with sequence data
**Resolution**: 1-degree grid cells
**Projection**: WGS84 Geographic

**Interpretation**:
- Darker colors = more EMF species with sequence data
- White areas = no EMF sequence data available
- Pattern shows research intensity and biodiversity hotspots

**Dimensions**: 10" × 8" at 300 DPI
**Format**: PNG
**Use**: Research intensity mapping, biodiversity assessment

---

### `canada_emf_proportion_map.png`
**Purpose**: Show proportion of tree species with EMF data

**Generated by**: `06_create_maps.R -> create_emf_proportion_map()`

**Content**:
- **Base layer**: Canada boundary in light grey
- **Data layer**: 1-degree grid cells colored by EMF coverage proportion
- **Color scale**: White to red gradient (0-100%)
  - White: 0% coverage (no EMF data)
  - Light blue: 1-20% coverage
  - Blue: 21-40% coverage
  - Dark blue: 41-60% coverage  
  - Red: 61-100% coverage

**Calculation**: (EMF species richness) / (Total tree species richness)
**Range**: 0.0 to 1.0 (0% to 100%)

**Interpretation**:
- Higher values = better EMF data coverage relative to tree diversity
- Lower values = knowledge gaps relative to potential diversity
- Identifies priority areas for future EMF research

**Dimensions**: 10" × 8" at 300 DPI
**Format**: PNG
**Use**: Knowledge gap assessment, research prioritization

---

### `canada_emf_bivariate_map.png`
**Purpose**: Combined analysis of tree richness and EMF data coverage

**Generated by**: `06_create_maps.R -> create_bivariate_map()`

**Content**:
- **Main map**: Canada with bivariate color scheme
- **Embedded legend**: 3×3 color matrix showing class combinations
- **Color scheme**: 
  - **X-axis** (bottom): Tree species richness (low to high)
  - **Y-axis** (left): EMF data coverage (low to high)
  - **Colors**: Light grey to dark purple diagonal

**Classification**:
- **Low richness, low coverage**: Light grey (data-poor regions)
- **High richness, low coverage**: Light blue (priority research areas)
- **Low richness, high coverage**: Pink (well-studied simple systems)
- **High richness, high coverage**: Dark purple (well-studied diverse systems)

**Analytical Value**:
- Identifies research priorities (high richness, low coverage)
- Shows well-studied areas (high coverage regardless of richness)
- Reveals knowledge gaps in diverse ecosystems

**Dimensions**: 14" × 10" at 300 DPI
**Format**: PNG
**Use**: Strategic research planning, comprehensive gap analysis

## Technical Specifications

### Map Projections
- **Main maps**: WGS84 Geographic (EPSG:4326)
- **Inset maps**: Canada Albers Equal Area (where applicable)
- **Coordinate grids**: 1-degree resolution for analysis

### Color Schemes
All maps use colorblind-friendly palettes:
- **Sequential**: White → Blue → Purple → Red
- **Categorical**: Rainbow with high contrast
- **Bivariate**: 3×3 matrix with perceptually uniform progression

### Cartographic Standards
- **Scale**: No explicit scale (continental extent)
- **North arrow**: Implied (conventional orientation)
- **Legends**: Positioned to avoid obscuring data
- **Boundaries**: Canada emphasized with bold black outline
- **Typography**: Sans-serif fonts, hierarchical sizing

### File Specifications
- **Format**: PNG (lossless compression)
- **Resolution**: 300 DPI (publication quality)
- **Color depth**: 24-bit RGB
- **Background**: White/transparent where appropriate

## Customization Options

### Modifying Map Appearance

#### Color Schemes
```r
# Change color palette for richness maps
emf_colors <- c("white", "yellow", "orange", "red", "darkred")

# Use in create_emf_richness_map()
scale_fill_gradientn(colors = emf_colors, ...)
```

#### Resolution
```r
# Create higher resolution maps
create_all_maps(resolution_deg = 0.5)  # 0.5-degree grid

# Or lower resolution for overview
create_all_maps(resolution_deg = 2)    # 2-degree grid
```

#### Map Extent
```r
# Focus on specific regions
# Modify coord_sf() limits in mapping functions
coord_sf(xlim = c(-140, -50), ylim = c(45, 70))  # Southern Canada only
```

### Adding Custom Elements

#### Additional Layers
```r
# Add cities or other reference points
cities <- data.frame(
  name = c("Vancouver", "Toronto", "Montreal"),
  lon = c(-123.1, -79.4, -73.6),
  lat = c(49.3, 43.7, 45.5)
)

# Add to existing map
base_map + 
  geom_point(data = cities, aes(x = lon, y = lat), 
             color = "red", size = 3) +
  geom_text(data = cities, aes(x = lon, y = lat, label = name),
            vjust = -1, color = "red")
```

#### Custom Annotations
```r
# Add text annotations
base_map +
  annotate("text", x = -100, y = 60, 
           label = "Research Priority Area",
           color = "red", size = 4, fontface = "bold")
```

### Export Options

#### Different Formats
```r
# Save as PDF for vector graphics
ggsave("figure.pdf", plot = map_object, 
       width = 12, height = 10, units = "in")

# Save as TIFF for publication
ggsave("figure.tiff", plot = map_object,
       width = 12, height = 10, units = "in", dpi = 300,
       compression = "lzw")

# Save as SVG for web use
ggsave("figure.svg", plot = map_object,
       width = 12, height = 10, units = "in")
```

#### Different Sizes
```r
# Presentation size (16:9 aspect ratio)
ggsave("presentation_figure.png", width = 16, height = 9, dpi = 150)

# Poster size
ggsave("poster_figure.png", width = 20, height = 16, dpi = 300)

# Thumbnail
ggsave("thumbnail.png", width = 4, height = 3, dpi = 150)
```

## Quality Control

### Visual Validation
Before using figures, check for:
- **Data completeness**: No unexpected white/missing areas
- **Color consistency**: Legends match mapped colors
- **Boundary accuracy**: Canada outline correctly positioned
- **Text legibility**: Labels and legends readable at intended size
- **Coordinate accuracy**: Features positioned correctly

### Automated Checks
```r
# Verify all figures were created
expected_files <- c(
  "canada_sampling_locations_map.png",
  "canada_emf_richness_map.png", 
  "canada_emf_proportion_map.png",
  "canada_emf_bivariate_map.png"
)

missing_files <- expected_files[!file.exists(file.path("figures", expected_files))]
if(length(missing_files) > 0) {
  warning("Missing figure files: ", paste(missing_files, collapse = ", "))
}
```

### File Size Management
```r
# Check figure file sizes
file_sizes <- file.size(list.files("figures", full.names = TRUE))
names(file_sizes) <- list.files("figures")
print(file_sizes)

# Large files (>10MB) may need compression
large_files <- file_sizes[file_sizes > 10*1024*1024]
```

## Usage Guidelines

### Publication Use

#### Journal Submission
- **Format**: TIFF or PDF preferred
- **Resolution**: 300-600 DPI minimum
- **Color space**: RGB for online, CMYK for print
- **Compression**: Lossless (LZW for TIFF)

#### Citation Requirements
Include in figure captions:
- Data sources (see rawdata/README.md)
- Analysis methods reference
- Software information: "Generated using R and ggplot2"

### Presentation Use

#### PowerPoint/Keynote
- Use PNG format for compatibility
- 150-300 DPI sufficient for screen display
- Consider white backgrounds for projection

#### Web Display
- PNG for static images
- SVG for interactive/scalable graphics
- Optimize file sizes for loading speed

### Print Use

#### Reports and Theses
- Minimum 300 DPI for quality printing
- Consider page layout when sizing
- Test print small sections first

#### Posters
- 300+ DPI for close viewing
- Larger text sizes may be needed
- High contrast colors for visibility

## Troubleshooting

### Common Issues

**Blank or incomplete maps**:
```r
# Check if data processing completed
validate_analysis_files()

# Re-run data processing if needed
source("scripts/05_calculate_metrics.R")
source("scripts/06_create_maps.R")
```

**Color/legend problems**:
```r
# Check data ranges
summary(raster_data)

# Verify color breaks align with data
breaks <- seq(min_val, max_val, length.out = 6)
```

**Memory errors during map creation**:
```r
# Reduce raster resolution
create_all_maps(resolution_deg = 2)

# Or create maps individually
source("scripts/06_create_maps.R")
sampling_map <- create_sampling_map()
```

**File corruption or access issues**:
```r
# Check file permissions
file.access("figures/", mode = 2)  # Check write permission

# Recreate specific figures
source("scripts/06_create_maps.R")
richness_map <- create_emf_richness_map()
ggsave("figures/canada_emf_richness_map.png", richness_map)
```

### Performance Optimization

**Large figure files**:
- Reduce DPI for draft versions
- Use JPEG for photographs, PNG for maps
- Consider PDF for vector graphics

**Slow rendering**:
- Simplify geometries before plotting
- Reduce point density for large datasets
- Use raster resampling for lower resolution

## Figure Interpretation Guide

### Sampling Coverage Map
- **Dense sampling**: Multiple overlapping points
- **Sparse sampling**: Isolated points, large gaps
- **No sampling**: Ecoregions without any points
- **Data source patterns**: Different datasets may show geographic bias

### Richness Maps
- **Hotspots**: Areas with high species concentrations
- **Gradients**: Smooth transitions vs. sharp boundaries  
- **Gaps**: Areas with no data (white) vs. low richness (light colors)
- **Artifacts**: Grid effects or processing boundaries

### Proportion Maps
- **High proportion**: Well-studied relative to diversity
- **Low proportion**: Knowledge gaps relative to potential
- **Zero proportion**: No EMF data despite tree presence
- **Spatial patterns**: Geographic, climatic, or accessibility bias

### Bivariate Map
- **Research priorities**: High richness, low coverage (blue tones)
- **Well-studied areas**: High coverage regardless of richness
- **Simple systems**: Low richness, potentially high coverage
- **Data deserts**: Low richness, low coverage (grey)

## Future Enhancements

### Planned Additions
- Interactive web maps using leaflet
- Animated maps showing temporal changes
- 3D visualizations of richness patterns
- Multi-panel figures for publications

### User Contributions
To add custom figures:
1. Create new mapping functions in `06_create_maps.R`
2. Follow existing naming conventions
3. Update this README with descriptions
4. Test with different data scenarios

### Integration Opportunities
- Climate data overlays
- Protected area boundaries
- Transportation networks
- Indigenous territory boundaries
- Elevation/terrain visualization